"0","profit_value <- matrix(nrow = nrow(pred_test), ncol = 3)"
"0",""
"0","# sort data"
"0","pred_test <- pred_test %>% arrange(desc(.pred_Yes))"
"0",""
"0","for (i in seq(1, nrow(pred_test), nrow(pred_test)*0.01)) {"
"0","  "
"0"," # set threshold"
"0"," thres <- pred_test$.pred_Yes[i]"
"0"," profit_value[i, 1] <- thres"
"0",""
"0"," # classify"
"0"," pred_test <- pred_test %>% "
"0","   mutate(predicted = ifelse(.pred_Yes < thres, ""No"", ""Yes""))"
"0"," profit_value[i, 2] <- pred_test %>% filter(predicted == ""Yes"") %>% nrow()/nrow(pred_test)"
"0"," "
"0"," # expected profit"
"0"," confuse <- table(Prediction = pred_test$predicted, Actual = pred_test$actual) %>% "
"0","   prop.table()"
"0"," profit_value[i, 3] <- expect_profit(confuse)"
"0","}"
"0",""
"0","profit_value <- profit_value %>% "
"0","  as.data.frame() %>% "
"0","  `colnames<-`(c(""threshold"", ""percent_yes"", ""expected_profit""))"
"0",""
"0","# Get threshold with maximum profit"
"0","max_profit <- profit_value %>% "
"0","  arrange(desc(expected_profit)) %>% "
"0","  slice(1)"
"0",""
"0","current_profit <- profit_value %>% "
"0","  arrange(threshold) %>% "
"0","  filter(threshold >= 0.5) %>% "
"0","  slice(1)"
"0",""
"0","# Visualize the result"
"0","profit_value %>% "
"0","  ggplot(aes(threshold, expected_profit)) +"
"0","  geom_line(color = ""firebrick"") +"
"0","  geom_hline(yintercept = 0, linetype = ""dashed"", color = ""skyblue4"") +"
"0","  geom_vline(xintercept = 0.5, linetype = ""dashed"", color = ""skyblue4"") +"
"0","  geom_vline(xintercept = max_profit$threshold, linetype = ""dashed"", color = ""green"") +"
"0","  geom_point(data = max_profit, size = 3) +"
"0","  ggrepel::geom_text_repel(data= max_profit, box.padding = 3, nudge_x = 0.1,"
"0","                           aes(label = glue::glue(""Max Profit"
"0","                                                  {comma(expected_profit, accuracy = 0.01)}""))"
"0","                               ) +"
"0","  geom_point(data = current_profit, size = 3) +"
"0","  ggrepel::geom_text_repel(data= current_profit, box.padding = 2, nudge_x = 0.1,"
"0","                           aes(label = glue::glue(""Current Profit"
"0","                                                  {comma(expected_profit, accuracy = 0.01)}""))"
"0","                               ) +"
"0","  theme_minimal() +"
"0","  theme(panel.grid.minor = element_blank()) +"
"0","  labs(title = ""Profit Curve"","
"0","       x = ""Threshold"", y = ""Expected Profit"")"
